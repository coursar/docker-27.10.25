# Dive

## Шаг 1. Установка

Установите [`trivy`](https://github.com/aquasecurity/trivy/releases), если ещё не установили его:
1. Скачайте установочный файл (amd64.deb)
2. Установите: `sudo apt install ./...amd64.deb`

## Шаг 2. Анализ образа

Проанализируйте один из созданных ранее образов на уязвимости и секреты:

```sh
trivy image IMAGE:TAG
```

Обратите внимание [на примечание касательно установленных с помощью пакетных менеджеров JAR-файлов](https://trivy.dev/docs/latest/scanner/vulnerability/#handling-software-installed-via-os-packages)

Убедитесь, что в [отчёте просканированных файлов будут](https://trivy.dev/docs/latest/coverage/language/java/#java):
* JAR-файлы в случае образа со Spring Boot
* WAR-файлы в случае образа с Tomcat

Поменяйте в проекте с Tomcat'ом одну из зависимостей (файл `pom.xml`) на [заведомо уязвимую версию](https://mvnrepository.com/artifact/com.google.code.gson/gson/2.8.8):
```xml
<gson.version>2.13.2</gson.version>
```

```xml
<gson.version>2.8.8</gson.version>
```

После чего перезапустите сканирование и убедитесь, что в выводе будет найдена уязвимость (среди прочих):

```
┌──────────────────────────────────────┬────────────────┬──────────┬────────┬───────────────────┬───────────────┬──────────────────────────────────────────────────────────────┐
│               Library                │ Vulnerability  │ Severity │ Status │ Installed Version │ Fixed Version │                            Title                             │
├──────────────────────────────────────┼────────────────┼──────────┼────────┼───────────────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│ com.google.code.gson:gson (ROOT.war) │ CVE-2022-25647 │ HIGH     │ fixed  │ 2.8.8             │ 2.8.9         │ com.google.code.gson-gson: Deserialization of Untrusted Data │
│                                      │                │          │        │                   │               │ in com.google.code.gson-gson                                 │
│                                      │                │          │        │                   │               │ https://avd.aquasec.com/nvd/cve-2022-25647                   │
└──────────────────────────────────────┴────────────────┴──────────┴────────┴───────────────────┴───────────────┴──────────────────────────────────────────────────────────────┘
```
