# Trivy

## Шаг 1. Установка

Установите [`trivy`](https://github.com/aquasecurity/trivy/releases):
1. Скачайте установочный файл (amd64.deb)
2. Установите: `sudo apt install ./...amd64.deb`

## Шаг 2. Анализ Dockerfile

Проанализируйте один из Dockerfile для созданных образов:

```sh
trivy config --misconfig-scanners=dockerfile Dockerfile 
```

Обратите внимание на код возврата (даже в случае ошибок):

```sh
echo $?
```

## Шаг 3. Установка кода возврата

Для CI trivy требует отдельного [флага для ненулевого кода возврата](https://trivy.dev/docs/latest/configuration/others/#exit-code):

```sh
trivy config --exit-code 1 --severity HIGH --misconfig-scanners=dockerfile Dockerfile 
```

Обратите внимание на код возврата:

```sh
echo $?
```

Попробуйте пересканировать для `CRITICAL` (в случае отсутствия `CRITICAL` в вашем `Dockerfile`):

```sh
trivy config --exit-code 1 --severity CRITICAL --misconfig-scanners=dockerfile Dockerfile 
```


